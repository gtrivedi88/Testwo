To illustrate how to use the optional workspace feature in the git-clone Task, let's take the following steps:

Create a Task called git-clone-optional-ws that clones a git repository using SSH authentication, with an optional workspace.
Define workspaces for the git-ssh secret and the optional workspace my-optional-workspace.
Define task parameters for the repository URL, revision, and the git-init image that the Task uses.
Define results that the Task produces, for example, the commit SHA and the repository URL.
Define the steps that the Task executes, including a condition to check if the optional workspace is bound before copying the content of the workspace to the user's home directory.

apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: git-clone-optional-ws
spec:
  workspaces:
    - name: git-ssh
      description: Workspace containing the git-ssh secret
    - name: my-optional-workspace
      description: Optional workspace that may be bound to a Pod or Container
      optional: true
  params:
    - name: url
      description: The URL of the Git repository to clone
      type: string
      default: ""
    - name: revision
      description: The Git revision to check out
      type: string
      default: "master"
    - name: image
      description: The image to use for the git-init container
      type: string
      default: "alpine/git:latest"
  results:
    - name: commit-sha
      description: The commit SHA of the checked out revision
    - name: repo-url
      description: The URL of the cloned Git repository
  steps:
    - name: clone
      image: $(params.image)
      workingDir: /workspace/source
      env:
        - name: GIT_SSH_COMMAND
          value: ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i /workspace/git-ssh/ssh-privatekey
      command:
        - sh
      args:
        - -c
        - |
          git clone $(params.url) .
          git checkout $(params.revision)
          echo $(git rev-parse HEAD) > $(results.commit-sha.path)
          echo $(params.url) > $(results.repo-url.path)
    - name: optional-workspace
      image: alpine:latest
      workingDir: /workspace
      command:
        - sh
      args:
        - -c
        - |
          if [ -d "/workspace/my-optional-workspace" ]; then
            cp -r /workspace/my-optional-workspace/* $HOME/
          fi


Create a secret with the ssh authentication content, for example, private key and known hosts.
Start the Task with the required parameters and workspace bindings. You can optionally bind the my-optional-workspace workspace to the Pod or Container where the Task runs.


apiVersion: tekton.dev/v1beta1
kind: TaskRun
metadata:
  name: my-git-clone-taskrun
spec:
  taskRef:
    name: my-git-clone-task
  params:
    - name: url
      value: https://github.com/my-org/my-repo.git
    - name: revision
      value: main
  workspaces:
    - name: my-workspace
      persistentVolumeClaim:
        claimName: my-pvc
    - name: my-optional-workspace
      volumeClaim:
        claimName: my-optional-pvc
  podTemplate:
    spec:
      containers:
        - name: my-container
          image: my-image
          volumeMounts:
            - name: my-workspace
              mountPath: /workspace
            - name: my-optional-workspace
              mountPath: /optional-workspace



